<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Owner Dashboard - ClubConnect</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Manrope:wght@300;400;500;600;700&family=Sora:wght@400;500;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
    <link rel="stylesheet" href="ui-base.css">
    <link rel="stylesheet" href="owner-dashboard.css">
    <script>
        (function () {
            const hostname = window.location.hostname;
            const isLocal = hostname === 'localhost' || hostname === '127.0.0.1';
            const isFile = window.location.protocol === 'file:' || !hostname;
            window.API_URL = (isLocal || isFile) ? 'http://localhost:4000' : 'https://club-connect-hvsz.onrender.com';
        })();
    </script>
</head>

<body>
    <!-- Top Navbar -->
    <nav class="top-navbar">
        <div class="navbar-brand">
            <button id="sidebarToggle" class="sidebar-toggle">
                <i class="fa-solid fa-bars"></i>
            </button>
            <i class="fa-solid fa-users-between-lines"></i>
            <span id="clubName">Loading...</span>
        </div>
        <div class="navbar-right">
            <label class="dark-mode-toggle" data-tooltip="Toggle Dark Mode">
                <input type="checkbox" id="darkModeToggle">
                <span class="toggle-slider"></span>
                <i class="fa-solid fa-moon"></i>
            </label>
            <div class="notification-bell" id="notificationBell" data-tooltip="Notifications"
                onclick="event.preventDefault(); event.stopPropagation(); const modal = document.getElementById('notificationsModal'); if(modal) { modal.classList.add('active'); loadNotifications(); }">
                <i class="fa-solid fa-bell"></i>
                <span class="notification-badge" id="notificationBadge">0</span>
            </div>
            <div class="messages-icon" id="messagesIcon" data-tooltip="Messages"
                onclick="event.preventDefault(); event.stopPropagation(); switchPage('messages');">
                <i class="fa-solid fa-message"></i>
                <span class="notification-badge" id="messageBadge">0</span>
            </div>
            <div class="user-menu">
                <div class="user-avatar">
                    <i class="fa-solid fa-user-circle"></i>
                </div>
                <div class="dropdown">
                    <button class="dropdown-btn">
                        <span id="ownerName">Owner</span>
                        <i class="fa-solid fa-chevron-down"></i>
                    </button>
                    <div class="dropdown-content" id="userDropdown">
                        <a href="#" onclick="return false;"><i class="fa-solid fa-user"></i> View Profile</a>
                        <a href="#" id="logoutBtn" class="danger-link" onclick="handleLogout(event); return false;">
                            <i class="fa-solid fa-right-from-bracket"></i>
                            Logout</a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <div class="dashboard-container">
        <div id="sidebarOverlay" class="sidebar-overlay"></div>
        <!-- Left Sidebar -->
        <aside class="sidebar">
            <ul class="menu">
                <li class="menu-item active" data-page="home" onclick="switchPage('home')">
                    <i class="fa-solid fa-house"></i>
                    <span>Dashboard</span>
                </li>
                <li class="menu-item" data-page="members" onclick="switchPage('members')">
                    <i class="fa-solid fa-users"></i>
                    <span>Members</span>
                </li>
                <li class="menu-item" data-page="events" onclick="switchPage('events')">
                    <i class="fa-solid fa-calendar-days"></i>
                    <span>Events</span>
                </li>
                <li class="menu-item" data-page="workshops" onclick="switchPage('workshops')">
                    <i class="fa-solid fa-chalkboard-user"></i>
                    <span>Workshops</span>
                </li>
                <li class="menu-item" data-page="announcements" onclick="switchPage('announcements')">
                    <i class="fa-solid fa-bullhorn"></i>
                    <span>Announcements</span>
                </li>
                <li class="menu-item" data-page="polls" onclick="switchPage('polls')">
                    <i class="fa-solid fa-chart-pie"></i>
                    <span>Polls</span>
                </li>
                <li class="menu-item" data-page="certificates" onclick="switchPage('certificates')">
                    <i class="fa-solid fa-certificate"></i>
                    <span>Certificates</span>
                </li>
                <li class="menu-item" data-page="project-progress" onclick="switchPage('project-progress')">
                    <i class="fa-solid fa-diagram-project"></i>
                    <span>Project Progress</span>
                </li>
                <li class="menu-item" data-page="analytics" onclick="switchPage('analytics')">
                    <i class="fa-solid fa-chart-line"></i>
                    <span>Analytics</span>
                </li>
                <li class="menu-item" data-page="messages" onclick="switchPage('messages')">
                    <i class="fa-solid fa-message"></i>
                    <span>Messages</span>
                </li>
                <li class="menu-item" data-page="settings" onclick="switchPage('settings')">
                    <i class="fa-solid fa-gear"></i>
                    <span>Club Settings</span>
                </li>
            </ul>
        </aside>

        <!-- Main Content Area -->
        <main class="content">
            <!-- Home Page -->
            <div class="page active" id="home-page">
                <div class="owner-home">
                    <div class="owner-welcome">
                        <div class="owner-welcome-content">
                            <div class="owner-welcome-text">
                                <h1>Welcome back, <span id="welcomeOwnerName">Owner</span>! <span
                                        class="owner-welcome-emoji">ðŸ‘‹</span></h1>
                                <p>Hereâ€™s a quick snapshot of <span id="welcomeClubName">your club</span> today.</p>
                            </div>
                            <div class="owner-welcome-actions">
                                <button class="btn-primary" onclick="switchPage('events')">
                                    <i class="fa-solid fa-plus"></i> Create Event
                                </button>
                                <button class="btn-secondary" onclick="switchPage('announcements')">
                                    <i class="fa-solid fa-bullhorn"></i> Send Announcement
                                </button>
                            </div>
                        </div>
                        <div class="owner-welcome-visual">
                            <div class="owner-visual-card owner-visual-primary">
                                <i class="fa-solid fa-users"></i>
                            </div>
                            <div class="owner-visual-card owner-visual-accent">
                                <i class="fa-solid fa-star"></i>
                            </div>
                            <div class="owner-visual-card owner-visual-ocean">
                                <i class="fa-solid fa-chart-line"></i>
                            </div>
                        </div>
                    </div>

                    <div class="owner-stats-grid">
                        <div class="owner-stat-card owner-stat-teal">
                            <div class="owner-stat-top">
                                <div class="owner-stat-icon">
                                    <i class="fa-solid fa-users"></i>
                                </div>
                                <span class="owner-stat-label">Total Members</span>
                            </div>
                            <div class="owner-stat-value" id="totalMembers">0</div>
                            <div class="owner-stat-subtext">Active club members</div>
                        </div>

                        <div class="owner-stat-card owner-stat-blue is-clickable" id="totalEventsCard">
                            <div class="owner-stat-top">
                                <div class="owner-stat-icon">
                                    <i class="fa-solid fa-calendar-check"></i>
                                </div>
                                <span class="owner-stat-label">Total Events</span>
                            </div>
                            <div class="owner-stat-value" id="totalEvents">0</div>
                            <div class="owner-stat-subtext">Events organized</div>
                        </div>

                        <div class="owner-stat-card owner-stat-purple">
                            <div class="owner-stat-top">
                                <div class="owner-stat-icon">
                                    <i class="fa-solid fa-star"></i>
                                </div>
                                <span class="owner-stat-label">Avg Attendance</span>
                            </div>
                            <div class="owner-stat-value" id="avgAttendance">0%</div>
                            <div class="owner-stat-subtext">Event participation</div>
                        </div>

                        <div class="owner-stat-card owner-stat-amber">
                            <div class="owner-stat-top">
                                <div class="owner-stat-icon">
                                    <i class="fa-solid fa-trophy"></i>
                                </div>
                                <span class="owner-stat-label">Top Member</span>
                            </div>
                            <div class="owner-stat-value owner-stat-value-lg" id="topMemberName">-</div>
                            <div class="owner-stat-subtext" id="topMemberPoints">0 points</div>
                        </div>
                    </div>

                    <div class="owner-home-grid">
                        <div class="owner-home-left">
                            <div class="owner-dashboard-card owner-card-events">
                                <div class="owner-card-header">
                                    <div class="owner-card-title">
                                        <i class="fa-solid fa-calendar-days"></i>
                                        <h3>Recent Events</h3>
                                    </div>
                                    <a href="#" onclick="switchPage('events')" class="owner-card-link">View All <i
                                            class="fa-solid fa-arrow-right"></i></a>
                                </div>
                                <div class="owner-card-body" id="recentEventsList">
                                    <div class="empty-state">
                                        <i class="fa-solid fa-calendar-xmark"></i>
                                        <p>No recent events</p>
                                    </div>
                                </div>
                            </div>

                            <div class="owner-dashboard-card">
                                <div class="owner-card-header">
                                    <div class="owner-card-title">
                                        <i class="fa-solid fa-bolt"></i>
                                        <h3>Quick Actions</h3>
                                    </div>
                                </div>
                                <div class="owner-card-body">
                                    <div class="owner-action-grid">
                                        <button class="owner-action-btn owner-action-primary"
                                            onclick="switchPage('events')">
                                            <i class="fa-solid fa-plus"></i>
                                            <span>Create Event</span>
                                        </button>
                                        <button class="owner-action-btn" onclick="switchPage('announcements')">
                                            <i class="fa-solid fa-bullhorn"></i>
                                            <span>Send Announcement</span>
                                        </button>
                                        <button class="owner-action-btn" onclick="switchPage('members')">
                                            <i class="fa-solid fa-users"></i>
                                            <span>Manage Members</span>
                                        </button>
                                        <button class="owner-action-btn" onclick="switchPage('analytics')">
                                            <i class="fa-solid fa-chart-line"></i>
                                            <span>View Analytics</span>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <div class="owner-dashboard-card">
                                <div class="owner-card-header">
                                    <div class="owner-card-title">
                                        <i class="fa-solid fa-clock-rotate-left"></i>
                                        <h3>Recent Activity</h3>
                                    </div>
                                    <a href="#" class="owner-card-link"
                                        onclick="document.getElementById('notificationsModal')?.classList.add('active'); loadNotifications(); return false;">View
                                        All <i class="fa-solid fa-arrow-right"></i></a>
                                </div>
                                <div class="owner-card-body" id="recentActivityList">
                                    <div class="empty-state">
                                        <i class="fa-solid fa-bell-slash"></i>
                                        <p>No recent activity</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="owner-home-right">
                            <div class="owner-dashboard-card owner-upcoming-card">
                                <div class="owner-card-header">
                                    <div class="owner-card-title">
                                        <i class="fa-solid fa-clock"></i>
                                        <h3>Upcoming Event</h3>
                                    </div>
                                    <a href="#" onclick="switchPage('events'); return false;"
                                        class="owner-card-link">Manage <i class="fa-solid fa-arrow-right"></i></a>
                                </div>
                                <div class="owner-card-body" id="upcomingEventBody">
                                    <div class="empty-state">
                                        <i class="fa-solid fa-calendar-plus"></i>
                                        <p>No upcoming events</p>
                                    </div>
                                </div>
                            </div>

                            <div class="owner-dashboard-card">
                                <div class="owner-card-header">
                                    <div class="owner-card-title">
                                        <i class="fa-solid fa-circle-check"></i>
                                        <h3>Owner Checklist</h3>
                                    </div>
                                </div>
                                <div class="owner-card-body">
                                    <div class="owner-checklist-progress">
                                        <span>0 of 3 tasks completed</span>
                                        <div class="owner-checklist-bar">
                                            <div class="owner-checklist-fill"></div>
                                        </div>
                                    </div>
                                    <div class="owner-checklist">
                                        <button class="owner-check-item" type="button" role="checkbox"
                                            aria-checked="false" data-check-id="post-weekly-update">
                                            <div class="owner-check-indicator" aria-hidden="true"></div>
                                            <div class="owner-check-icon" aria-hidden="true">
                                                <i class="fa-solid fa-bullhorn"></i>
                                            </div>
                                            <div class="owner-check-content">
                                                <h4>Post weekly update</h4>
                                                <p>Keep members engaged with the latest news.</p>
                                            </div>
                                        </button>
                                        <button class="owner-check-item" type="button" role="checkbox"
                                            aria-checked="false" data-check-id="plan-next-event">
                                            <div class="owner-check-indicator" aria-hidden="true"></div>
                                            <div class="owner-check-icon" aria-hidden="true">
                                                <i class="fa-solid fa-calendar-day"></i>
                                            </div>
                                            <div class="owner-check-content">
                                                <h4>Plan next event</h4>
                                                <p>Schedule something exciting for your club.</p>
                                            </div>
                                        </button>
                                        <button class="owner-check-item" type="button" role="checkbox"
                                            aria-checked="false" data-check-id="review-member-roles">
                                            <div class="owner-check-indicator" aria-hidden="true"></div>
                                            <div class="owner-check-icon" aria-hidden="true">
                                                <i class="fa-solid fa-users-gear"></i>
                                            </div>
                                            <div class="owner-check-content">
                                                <h4>Review member roles</h4>
                                                <p>Assign roles to keep your team active.</p>
                                            </div>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <div class="owner-dashboard-card">
                                <div class="owner-card-header">
                                    <div class="owner-card-title">
                                        <i class="fa-solid fa-trophy"></i>
                                        <h3>Top Members</h3>
                                    </div>
                                    <a href="#" onclick="switchPage('members'); return false;"
                                        class="owner-card-link">View All <i class="fa-solid fa-arrow-right"></i></a>
                                </div>
                                <div class="owner-card-body" id="topMembersList">
                                    <div class="empty-state">
                                        <i class="fa-solid fa-users"></i>
                                        <p>No members yet</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Members Page -->
            <div class="page" id="members-page">
                <div class="page-header">
                    <h1>Club Members</h1>
                </div>

                <!-- Member Search -->
                <div class="search-section panel">
                    <div class="search-row">
                        <div class="search-field">
                            <i class="fa-solid fa-search search-icon"></i>
                            <input type="text" id="memberSearchInput" class="search-input"
                                placeholder="Search members by name, email, or student ID..." onkeyup="searchMembers()">
                        </div>
                        <button onclick="clearSearch()" class="btn-secondary btn-compact">
                            <i class="fa-solid fa-times"></i> Clear
                        </button>
                    </div>
                    <div id="searchResults" class="search-results"></div>
                </div>

                <!-- Add Member Section -->
                <div class="add-member-section panel panel-subtle">
                    <h3 class="section-title">
                        <i class="fa-solid fa-user-plus"></i> Quick Add Member
                    </h3>
                    <div class="add-member-row">
                        <div class="add-member-field">
                            <label class="field-label">Student ID</label>
                            <input type="text" id="quickAddStudentId" class="field-input"
                                placeholder="Enter student ID...">
                        </div>
                        <button onclick="addMemberByStudentId(); return false;" class="btn-primary btn-wide">
                            <i class="fa-solid fa-plus"></i> Add Member
                        </button>
                    </div>
                    <p class="hint-text">
                        <i class="fa-solid fa-info-circle"></i> Enter the student ID of a registered user to add them to
                        your club
                    </p>
                </div>

                <div class="members-table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Student ID</th>
                                <th>Role</th>
                                <th>Points</th>
                                <th>Rank</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="membersTableBody">
                            <tr>
                                <td colspan="7" class="loading">Loading members...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Events Page -->
            <div class="page" id="events-page">
                <div class="page-header">
                    <h1>Events Management</h1>
                    <button class="btn-primary" onclick="showCreateEventForm()">
                        <i class="fa-solid fa-plus"></i> Create New Event
                    </button>
                </div>

                <!-- Create Event Form (Hidden by default) -->
                <div class="event-form-container" id="createEventForm" style="display:none;">
                    <h3>Create New Event</h3>
                    <form id="eventForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label>Event Title *</label>
                                <input type="text" id="eventTitle" required>
                            </div>
                            <div class="form-group">
                                <label>Date *</label>
                                <input type="date" id="eventDate" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Venue *</label>
                                <input type="text" id="eventVenue" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Description</label>
                            <textarea id="eventDescription" rows="3"></textarea>
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn-primary">Create Event</button>
                            <button type="button" class="btn-secondary" onclick="hideCreateEventForm()">Cancel</button>
                        </div>
                    </form>
                </div>

                <div class="events-grid" id="eventsGrid">
                    <p class="loading">Loading events...</p>
                </div>
            </div>

            <!-- Announcements Page -->
            <div class="page" id="announcements-page">
                <div class="page-header">
                    <h1>Announcements</h1>
                    <p>Send messages to all club members</p>
                </div>

                <div class="announcement-form">
                    <h3>Send New Announcement</h3>
                    <form id="announcementForm">
                        <div class="form-group">
                            <label>Title</label>
                            <input type="text" id="announcementTitle" placeholder="Announcement Title">
                        </div>
                        <div class="form-group">
                            <label>Message *</label>
                            <textarea id="announcementMessage" rows="4" placeholder="Type your message here..."
                                required></textarea>
                        </div>
                        <button type="submit" class="btn-primary">
                            <i class="fa-solid fa-paper-plane"></i> Send Announcement
                        </button>
                    </form>
                </div>

                <div class="announcements-list">
                    <h3>Recent Announcements</h3>
                    <div id="announcementsList">
                        <p class="loading">Loading announcements...</p>
                    </div>
                </div>
            </div>

            <!-- Polls Page -->
            <div class="page" id="polls-page">
                <div class="polls-create-layout">
                    <div class="poll-create-card">
                        <div class="poll-create-header">
                            <div class="poll-create-title">
                                <h1>Create Club Poll</h1>
                                <p>Create a poll for your club members to collect their opinions.</p>
                            </div>
                        </div>
                        <div class="poll-create-divider"></div>
                        <form id="pollForm" class="poll-create-form">
                            <div class="form-group">
                                <label for="pollQuestion">Poll Question *</label>
                                <input type="text" id="pollQuestion"
                                    placeholder="Enter the question you want your club members to vote on (e.g. Which event should we organize next?)"
                                    maxlength="150" required>
                                <p class="field-error" id="pollQuestionError"></p>
                            </div>
                            <div class="poll-options-section">
                                <label>Poll Options *</label>
                                <div class="poll-options-box">
                                    <div id="pollOptionsList" class="poll-options-list"></div>
                                    <p class="field-error" id="pollOptionsError"></p>
                                    <button type="button" class="poll-add-option" id="addPollOptionBtn">
                                        <i class="fa-solid fa-plus"></i> Add another option
                                    </button>
                                </div>
                            </div>
                            <div class="poll-vote-type">
                                <label>Voting Type</label>
                                <div class="poll-segmented">
                                    <input type="radio" id="pollVoteSingle" name="pollVotingType" value="single"
                                        checked>
                                    <label for="pollVoteSingle" class="poll-segment">
                                        <i class="fa-solid fa-circle-dot"></i>
                                        Single choice
                                    </label>
                                    <input type="radio" id="pollVoteMultiple" name="pollVotingType" value="multiple">
                                    <label for="pollVoteMultiple" class="poll-segment">
                                        <i class="fa-solid fa-layer-group"></i>
                                        Multiple choice
                                    </label>
                                </div>
                            </div>
                            <div class="poll-end-date">
                                <div class="poll-toggle-row">
                                    <div class="poll-toggle-text">
                                        <span>Set poll end date</span>
                                        <span class="poll-toggle-hint">Optional</span>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="pollEndDateToggle">
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                                <div class="poll-end-date-field" id="pollEndDateField">
                                    <label for="pollEndDate">Poll End Date</label>
                                    <input type="date" id="pollEndDate">
                                </div>
                            </div>
                            <div class="poll-form-actions">
                                <button type="submit" class="btn-primary btn-animate" id="pollCreateBtn" disabled>Create
                                    Poll</button>
                            </div>
                        </form>
                        <div class="poll-success-banner" id="pollSuccessBanner"></div>
                    </div>
                    <div class="polls-list-panel">
                        <div class="polls-list-header">
                            <h3>All Polls</h3>
                            <p>Scroll to view every poll</p>
                        </div>
                        <div class="polls-list-scroll" id="pollsList">
                            <p class="loading">Loading polls...</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="page" id="certificates-page">
                <div class="page-header">
                    <h1>Certificates</h1>
                    <p>Manage certificates uploaded by members</p>
                </div>
                <div class="certificates-grid" id="ownerCertificatesGrid">
                    <p class="loading">Loading certificates...</p>
                </div>
            </div>

            <!-- Project Progress Page -->
            <div class="page" id="project-progress-page">
                <div class="project-progress-banner progress-banner" id="projectProgressBanner">
                    <h2 class="banner-title" id="projectProgressClubName">Club Name</h2>
                    <p class="banner-text" id="projectProgressClubDesc">Club description</p>
                    <div class="banner-pills">
                        <span id="projectProgressMembersPill" class="banner-pill"><i class="fa-solid fa-users"></i> 0
                            Members</span>
                        <span id="projectProgressIdeasPill" class="banner-pill"><i class="fa-solid fa-lightbulb"></i> 0
                            Projects</span>
                    </div>
                </div>
                <div class="project-metrics-row metrics-row">
                    <div class="metric-card">
                        <div class="metric-label">Total Members</div>
                        <div id="metricTotalMembers" class="metric-value">0</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Completed</div>
                        <div id="metricCompleted" class="metric-value success">0</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">In Progress</div>
                        <div id="metricInProgress" class="metric-value warning">0</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Avg. Progress</div>
                        <div id="metricAvgProgress" class="metric-value primary">0%</div>
                    </div>
                </div>
                <div class="panel panel-stack">
                    <div class="panel-header-row">
                        <h3 class="panel-title">Members & Projects</h3>
                        <span id="projectProgressPendingBadge" class="badge-pill warning" style="display: none;"><i
                                class="fa-solid fa-clock"></i> <span id="pendingCount">0</span> Pending approval</span>
                    </div>
                    <div id="projectProgressMembersGrid" class="project-members-grid">
                        <p class="loading">Loading...</p>
                    </div>
                </div>
                <div class="panel">
                    <h3 class="panel-title">Manage Project Ideas</h3>
                    <p class="panel-text">Add project ideas that members can choose from. Once a member chooses an idea,
                        only the description can be edited.</p>
                    <button type="button" class="btn-primary btn-inline" onclick="showAddProjectIdeaForm()"><i
                            class="fa-solid fa-plus"></i> Add Project Idea</button>
                    <div id="projectIdeasList" class="panel-list"></div>
                </div>
            </div>

            <!-- Analytics Page -->
            <div class="page" id="analytics-page">
                <div class="page-header">
                    <h1>Advanced Analytics</h1>
                    <div class="analytics-controls">
                        <select id="analyticsPeriod" class="form-control select-control"
                            onchange="loadAdvancedAnalytics()">
                            <option value="7">Last 7 days</option>
                            <option value="30" selected>Last 30 days</option>
                            <option value="90">Last 90 days</option>
                            <option value="365">Last year</option>
                        </select>
                    </div>
                </div>

                <div id="analyticsContent">
                    <div class="loading-spinner">
                        <div class="spinner"></div>
                        <p>Loading analytics...</p>
                    </div>
                </div>
            </div>

            <!-- Messages Page -->
            <div class="page" id="messages-page">
                <div class="page-header">
                    <h1>Messages</h1>
                    <button class="btn-primary" onclick="openNewMessageModal()">
                        <i class="fa-solid fa-plus"></i> New Message
                    </button>
                </div>

                <div class="messages-layout">
                    <!-- Message List -->
                    <div class="messages-panel">
                        <h3 class="panel-title">Conversations</h3>
                        <div id="messageList" class="message-list">
                            <p class="loading">Loading conversations...</p>
                        </div>
                    </div>

                    <!-- Message Chat -->
                    <div class="chat-panel">
                        <div id="chatHeader" class="chat-header">
                            <p class="chat-placeholder">Select a conversation to start messaging</p>
                        </div>
                        <div id="chatMessages" class="chat-messages">
                        </div>
                        <div id="chatInput" class="chat-input" style="display: none;">
                            <form id="messageForm" onsubmit="sendMessage(event)">
                                <div class="chat-row">
                                    <input type="text" id="messageInput" class="chat-text-input"
                                        placeholder="Type a message..." required>
                                    <button type="submit" class="btn-primary">
                                        <i class="fa-solid fa-paper-plane"></i>
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <div class="page" id="workshops-page">
                <!-- Workshop Hero Header -->
                <div class="ws-hero">
                    <div class="ws-hero-content">
                        <div class="ws-hero-text">
                            <h1><i class="fa-solid fa-chalkboard-user"></i> Workshops</h1>
                            <p class="ws-hero-subtitle">Create interactive coding sessions for your club members</p>
                        </div>
                        <button class="ws-create-btn" onclick="openWorkshopCreateModal()">
                            <i class="fa-solid fa-plus"></i> New Workshop
                        </button>
                    </div>
                </div>

                <!-- Workshop Cards Grid -->
                <div id="ownerWorkshopCards" class="ws-cards-grid">
                    <div class="loading-spinner">
                        <div class="spinner"></div>
                        <p>Loading workshops...</p>
                    </div>
                </div>

                <!-- Workshop Detail Overlay -->
                <div class="ws-detail-overlay" id="ownerWorkshopDetail">
                    <div class="ws-detail-panel">
                        <button class="ws-detail-close" onclick="closeWorkshopDetail()"><i
                                class="fa-solid fa-xmark"></i></button>
                        <div class="ws-detail-content" id="ownerWorkshopDetailContent" style="display:none;">
                            <div class="ws-detail-badge-row">
                                <span class="workshop-status-badge" id="ownerWorkshopStatus">Upcoming</span>
                            </div>
                            <h2 class="ws-detail-title" id="ownerWorkshopTitle">Workshop</h2>
                            <p class="ws-detail-desc" id="ownerWorkshopDescription"></p>
                            <div class="ws-detail-info-grid">
                                <div class="ws-info-chip"><i class="fa-regular fa-clock"></i> <span
                                        id="ownerWorkshopTime">-</span></div>
                                <div class="ws-info-chip"><i class="fa-regular fa-user"></i> <span
                                        id="ownerWorkshopInstructor">-</span></div>
                            </div>
                            <div class="ws-tools-section">
                                <h3><i class="fa-solid fa-toolbox"></i> Required Tools</h3>
                                <div id="ownerWorkshopTools" class="ws-tools-list"></div>
                            </div>
                            <div class="ws-detail-actions">
                                <button class="ws-btn ws-btn-outline" id="ownerWorkshopStartBtn"
                                    onclick="startWorkshopSession()">
                                    <i class="fa-solid fa-broadcast-tower"></i> Go Live
                                </button>
                                <button class="ws-btn ws-btn-solid" id="ownerWorkshopNextBtn"
                                    onclick="openWorkshopInterface()" disabled>
                                    <i class="fa-solid fa-arrow-right"></i> Enter Workshop
                                </button>
                            </div>
                        </div>
                        <div class="ws-detail-empty" id="wsDetailEmpty">
                            <i class="fa-solid fa-laptop-code"></i>
                            <p>Select a workshop to view details</p>
                        </div>
                    </div>
                </div>

                <!-- Workshop Live Interface -->
                <div class="ws-interface" id="ownerWorkshopInterface" style="display: none;">
                    <div class="ws-interface-top">
                        <div class="ws-interface-title-area">
                            <button class="ws-back-btn" onclick="closeWorkshopInterface()"><i
                                    class="fa-solid fa-arrow-left"></i></button>
                            <div>
                                <h2 id="ownerInterfaceTitle">Live Workshop</h2>
                                <div class="ws-live-badge"><span class="ws-live-dot"></span> Live Session</div>
                            </div>
                        </div>
                        <div class="ws-interface-toolbar">
                            <div class="ws-lang-select-wrap">
                                <i class="fa-solid fa-code"></i>
                                <select id="ownerLanguageSelect">
                                    <option value="html">HTML</option>
                                    <option value="javascript">JavaScript</option>
                                    <option value="css">CSS</option>
                                    <option value="python">Python</option>
                                    <option value="java">Java</option>
                                    <option value="cpp">C++</option>
                                    <option value="plaintext">Plain Text</option>
                                </select>
                            </div>
                            <button class="ws-toolbar-btn ws-toolbar-draft" onclick="saveWorkshopCode(false)">
                                <i class="fa-regular fa-floppy-disk"></i> Save Draft
                            </button>
                            <button class="ws-toolbar-btn ws-toolbar-publish" onclick="publishWorkshopToStudents()">
                                <i class="fa-solid fa-paper-plane"></i> Publish to Students
                            </button>
                            <button class="ws-toolbar-btn" onclick="pauseWorkshopSession()">
                                <i class="fa-solid fa-pause"></i> Pause
                            </button>
                            <button class="ws-toolbar-btn" onclick="endWorkshopSession()">
                                <i class="fa-solid fa-flag-checkered"></i> End
                            </button>
                        </div>
                    </div>
                    <div class="ws-interface-body">
                        <div class="ws-editor-area">
                            <div class="ws-editor-header">
                                <span><i class="fa-solid fa-terminal"></i> Code Editor</span>
                                <span class="ws-editor-hint">Paste your code here â€” students see it live</span>
                            </div>
                            <textarea id="ownerWorkshopEditor"
                                placeholder="// Paste your full source code here...&#10;// Students will see updates in real time after you publish.&#10;&#10;"></textarea>
                        </div>
                        <div class="ws-sidebar">
                            <div class="ws-sidebar-card ws-sections-card">
                                <div class="ws-sidebar-card-header">
                                    <h3><i class="fa-solid fa-layer-group"></i> Sections</h3>
                                    <button class="ws-chip-btn" onclick="createSectionFromSelection()"><i
                                            class="fa-solid fa-scissors"></i> Split</button>
                                </div>
                                <div class="ws-section-form">
                                    <input type="text" id="sectionNameInput" placeholder="Section name"
                                        class="ws-input">
                                    <div class="ws-section-range">
                                        <input type="number" id="sectionStartInput" placeholder="From"
                                            class="ws-input ws-input-sm">
                                        <span class="ws-range-sep">â€”</span>
                                        <input type="number" id="sectionEndInput" placeholder="To"
                                            class="ws-input ws-input-sm">
                                    </div>
                                    <button class="ws-btn ws-btn-solid ws-btn-sm" onclick="createSectionManual()"><i
                                            class="fa-solid fa-plus"></i> Create</button>
                                </div>
                                <div id="ownerSectionsList" class="ws-sections-list"></div>
                            </div>
                            <div class="ws-sidebar-card ws-participants-card">
                                <div class="ws-sidebar-card-header">
                                    <h3><i class="fa-solid fa-users"></i> Participants</h3>
                                </div>
                                <div class="ws-participant-count" id="ownerParticipantsCount">
                                    <span class="ws-participant-num">0</span> connected
                                </div>
                            </div>
                            <div class="ws-sidebar-card ws-preview-card">
                                <div class="ws-sidebar-card-header">
                                    <h3><i class="fa-solid fa-eye"></i> Preview</h3>
                                    <button class="ws-chip-btn" id="ownerPreviewToggle" onclick="togglePreview()"><i
                                            class="fa-solid fa-play"></i> Enable</button>
                                </div>
                                <div class="ws-preview-container" id="ownerPreviewContainer" style="display: none;">
                                    <iframe id="ownerPreviewFrame" sandbox="allow-scripts"></iframe>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings Page -->
            <div class="page" id="settings-page">
                <div class="page-header">
                    <h1>Club Settings</h1>
                    <p>Customize your club</p>
                </div>

                <div class="settings-form">
                    <form id="settingsForm">
                        <div class="form-group">
                            <label>Club Name</label>
                            <input type="text" id="settingsClubName">
                        </div>
                        <div class="form-group">
                            <label>Tagline</label>
                            <input type="text" id="settingsTagline" placeholder="Innovation & Technology">
                        </div>
                        <div class="form-group">
                            <label>Theme Color</label>
                            <input type="color" id="settingsThemeColor">
                        </div>
                        <button type="submit" class="btn-primary">
                            <i class="fa-solid fa-save"></i> Save Changes
                        </button>
                    </form>
                </div>
            </div>
        </main>
    </div>

    <!-- Award Points Modal -->
    <div class="modal" id="awardPointsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Award Points</h3>
                <button class="modal-close" onclick="closeAwardPointsModal()">&times;</button>
            </div>
            <div class="modal-body">
                <p>Award points to <strong id="awardMemberName"></strong></p>
                <div class="points-options">
                    <button class="points-btn" onclick="awardPoints(10)">+10 Points</button>
                    <button class="points-btn" onclick="awardPoints(20)">+20 Points</button>
                    <button class="points-btn" onclick="awardPoints(50)">+50 Points</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification Toast -->
    <div id="notificationContainer"></div>

    <div class="modal" id="workshopCreateModal">
        <div class="modal-content modal-lg">
            <div class="modal-header">
                <h3>Create Workshop</h3>
                <button class="modal-close" onclick="closeWorkshopCreateModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="workshopCreateForm">
                    <div class="form-group">
                        <label>Title</label>
                        <input type="text" id="workshopTitleInput" required>
                    </div>
                    <div class="form-group">
                        <label>Description</label>
                        <textarea id="workshopDescriptionInput" rows="4"></textarea>
                    </div>
                    <div class="form-group">
                        <label>Start Time</label>
                        <input type="datetime-local" id="workshopStartInput">
                    </div>
                    <div class="form-group">
                        <label>End Time</label>
                        <input type="datetime-local" id="workshopEndInput">
                    </div>
                    <div class="form-group">
                        <label>Required Tools</label>
                        <div id="workshopToolsBuilder" class="tools-builder">
                            <div class="tool-row">
                                <input type="text" class="tool-name" placeholder="Tool name">
                                <input type="text" class="tool-version" placeholder="Version">
                                <input type="url" class="tool-link" placeholder="Download link">
                                <input type="text" class="tool-icon" placeholder="Icon class (optional)">
                            </div>
                        </div>
                        <button type="button" class="btn-secondary btn-small" onclick="addToolRow()">Add Tool</button>
                    </div>
                    <button type="submit" class="btn-primary">Create Workshop</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Notifications Modal -->
    <div class="modal" id="notificationsModal">
        <div class="modal-content modal-md">
            <div class="modal-header">
                <h3><i class="fa-solid fa-bell"></i> Notifications</h3>
                <div>
                    <button onclick="markAllNotificationsRead()" class="btn-secondary btn-sm">
                        Mark All Read
                    </button>
                    <button class="modal-close" onclick="closeNotificationsModal()">&times;</button>
                </div>
            </div>
            <div class="modal-body modal-scroll">
                <div id="notificationsList">
                    <p class="loading">Loading notifications...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Attendance Taking Modal -->
    <div class="modal" id="attendanceModal">
        <div class="modal-content modal-lg">
            <div class="modal-header">
                <h3><i class="fa-solid fa-clipboard-check"></i> Take Attendance</h3>
                <button class="modal-close" onclick="closeAttendanceModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="attendanceContent">
                    <p class="loading">Loading...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Role Assignment Modal -->
    <div class="modal" id="roleModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Assign Role</h3>
                <button class="modal-close" onclick="closeRoleModal()">&times;</button>
            </div>
            <div class="modal-body">
                <p>Assign role to <strong id="roleMemberName"></strong></p>
                <div class="form-group">
                    <label>Select Role</label>
                    <select id="roleSelect" class="form-control">
                        <option value="member">Member</option>
                        <option value="moderator">Moderator</option>
                        <option value="admin">Admin</option>
                    </select>
                </div>
                <button onclick="assignRole()" class="btn-primary btn-block">
                    <i class="fa-solid fa-save"></i> Save Role
                </button>
            </div>
        </div>
    </div>

    <!-- New Message Modal -->
    <div class="modal" id="newMessageModal">
        <div class="modal-content modal-md">
            <div class="modal-header">
                <h3><i class="fa-solid fa-message"></i> New Message</h3>
                <button class="modal-close" onclick="closeNewMessageModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="newMessageForm">
                    <div class="form-group">
                        <label>Select Recipient</label>
                        <select id="recipientSelect" class="form-control" required>
                            <option value="">Choose a member...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Message</label>
                        <textarea id="newMessageText" class="form-control" rows="5" required></textarea>
                    </div>
                    <button type="submit" class="btn-primary btn-block">
                        <i class="fa-solid fa-paper-plane"></i> Send Message
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Member Profile Modal -->
    <div class="modal" id="memberProfileModal">
        <div class="modal-content modal-lg">
            <div class="modal-header">
                <h3><i class="fa-solid fa-id-badge"></i> Member Profile</h3>
                <button class="modal-close" onclick="closeMemberProfile()">&times;</button>
            </div>
            <div class="modal-body" id="memberProfileContent">
                <div class="loading-spinner">
                    <div class="spinner"></div>
                    <p>Loading profile...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- All Events Modal -->
    <div class="modal" id="allEventsModal">
        <div class="modal-content modal-xl events-modal-content">
            <div class="modal-header events-modal-header">
                <h3 class="events-modal-title">
                    <i class="fa-solid fa-calendar-days events-modal-icon"></i>
                    <span>All Events</span>
                </h3>
                <button class="modal-close events-modal-close"
                    onclick="document.getElementById('allEventsModal').classList.remove('active')">&times;</button>
            </div>
            <div class="modal-body events-modal-body">
                <div class="events-search-container">
                    <i class="fa-solid fa-search events-search-icon"></i>
                    <input id="eventsSearchInput" type="text" class="events-search-input"
                        placeholder="Search events by title or venue...">
                </div>
                <div class="events-table-wrapper">
                    <table class="events-table" id="allEventsTable">
                        <thead>
                            <tr class="events-table-header-row">
                                <th class="events-table-header">Title</th>
                                <th class="events-table-header">Date</th>
                                <th class="events-table-header">Venue</th>
                                <th class="events-table-header events-table-header-center">RSVPs</th>
                                <th class="events-table-header events-table-header-center">Attended</th>
                            </tr>
                        </thead>
                        <tbody id="eventsTableBody">
                            <tr>
                                <td colspan="5" class="loading">Loading events...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- QR Attendance Session Modal -->
    <div class="modal" id="qrAttendanceModal">
        <div class="modal-content modal-lg">
            <div class="modal-header">
                <h3><i class="fa-solid fa-qrcode"></i> QR Attendance Session</h3>
                <button class="modal-close" onclick="closeQRAttendanceSession()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="qrAttendanceContent">
                    <div style="display: flex; gap: 30px; flex-wrap: wrap;">
                        <!-- Left: QR Code + Code -->
                        <div style="flex: 1; min-width: 300px; text-align: center;">
                            <h4 id="qrEventTitle" style="margin: 0 0 20px 0;">Event Title</h4>

                            <!-- QR Code -->
                            <div id="qrCodeContainer"
                                style="padding: 20px; background: white; border-radius: 16px; display: inline-block; box-shadow: 0 4px 20px rgba(0,0,0,0.1);">
                                <canvas id="qrCanvas" width="200" height="200"></canvas>
                            </div>

                            <!-- 7-Digit Code Display -->
                            <div
                                style="margin-top: 20px; padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 16px; box-shadow: 0 4px 20px rgba(102, 126, 234, 0.3);">
                                <p
                                    style="margin: 0 0 8px 0; color: rgba(255,255,255,0.8); font-size: 13px; letter-spacing: 1px;">
                                    OR ENTER CODE</p>
                                <div id="attendanceCodeDisplay"
                                    style="font-size: 32px; font-weight: 800; color: white; letter-spacing: 8px; font-family: 'Courier New', monospace;">
                                    ABC XYZ K</div>
                            </div>

                            <!-- Timer -->
                            <div style="margin-top: 20px;">
                                <div
                                    style="display: flex; align-items: center; justify-content: center; gap: 10px; margin-bottom: 15px;">
                                    <i class="fa-solid fa-clock" style="color: #f59e0b;"></i>
                                    <span style="font-size: 18px; font-weight: 600;">Refreshing in <span
                                            id="qrCountdown">25</span>s</span>
                                </div>
                                <div style="height: 4px; background: #e5e7eb; border-radius: 2px; overflow: hidden;">
                                    <div id="qrProgressBar"
                                        style="width: 100%; height: 100%; background: linear-gradient(90deg, #10b981, #34d399); transition: width 0.1s linear;">
                                    </div>
                                </div>
                            </div>
                            <p style="margin-top: 15px; font-size: 13px; color: #6b7280;">
                                <i class="fa-solid fa-shield-halved"></i> Code & QR refresh every 25 seconds
                            </p>
                        </div>
                        <!-- Right: Live Attendance -->
                        <div style="flex: 1; min-width: 280px;">
                            <div
                                style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                <h4 style="margin: 0;">Live Attendance</h4>
                                <div style="display: flex; gap: 10px;">
                                    <span id="qrPresentCount"
                                        style="background: #10b981; color: white; padding: 4px 12px; border-radius: 20px; font-size: 14px; font-weight: 600;">0
                                        Present</span>
                                    <span id="qrLateCount"
                                        style="background: #f59e0b; color: white; padding: 4px 12px; border-radius: 20px; font-size: 14px; font-weight: 600; display: none;">0
                                        Late</span>
                                </div>
                            </div>
                            <div id="qrAttendeesList"
                                style="max-height: 350px; overflow-y: auto; border: 1px solid #e5e7eb; border-radius: 12px; background: #fafafb;">
                                <p style="padding: 40px 20px; text-align: center; color: #9ca3af;">
                                    <i class="fa-solid fa-users"
                                        style="font-size: 32px; margin-bottom: 10px; display: block;"></i>
                                    Waiting for members to scan...
                                </p>
                            </div>
                            <div style="margin-top: 20px;">
                                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                                    <i class="fa-solid fa-hourglass-half" style="color: #6b7280;"></i>
                                    <span>Session expires: <strong id="qrExpiresAt">-</strong></span>
                                </div>
                                <button onclick="exportQRAttendance()" class="btn-primary" style="width: 100%; margin-bottom: 10px;">
                                    <i class="fa-solid fa-file-export"></i> Export Attendance
                                </button>
                                <button onclick="endQRAttendanceSession()" class="btn-secondary" style="width: 100%;">
                                    <i class="fa-solid fa-stop"></i> End Session
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="utils.js"></script>

    <!-- Inline script to ensure functions work immediately -->
    <script>
        console.log('ðŸ”§ Initializing fallback functions...');

        // Simple fallback switchPage function that works immediately
        window.switchPage = window.switchPage || function (pageName) {
            console.log('ðŸ”„ switchPage called:', pageName);
            try {
                // Update menu
                document.querySelectorAll('.menu-item').forEach(item => {
                    item.classList.remove('active');
                    if (item.getAttribute('data-page') === pageName) {
                        item.classList.add('active');
                    }
                });

                // Update pages
                document.querySelectorAll('.page').forEach(page => {
                    page.classList.remove('active');
                });
                const targetPage = document.getElementById(pageName + '-page');
                if (targetPage) {
                    targetPage.classList.add('active');
                    console.log('âœ… Page switched to:', pageName);
                } else {
                    console.error('âŒ Page not found:', pageName + '-page');
                }
            } catch (error) {
                console.error('âŒ Error in switchPage:', error);
            }
        };

        // Fallback addMemberByStudentId
        window.addMemberByStudentId = window.addMemberByStudentId || function () {
            alert('Function loading... Please wait and try again.');
        };

        // Fallback loadNotifications
        window.loadNotifications = window.loadNotifications || function () {
            console.log('loadNotifications called (fallback)');
        };

        // Fallback handleLogout
        window.handleLogout = window.handleLogout || function (e) {
            if (e) {
                e.preventDefault();
                e.stopPropagation();
            }
            console.log('ðŸšª Logout (fallback)');
            localStorage.removeItem('token');
            localStorage.removeItem('darkMode');
            window.location.href = 'index.html';
        };

        console.log('âœ… Fallback functions initialized');
    </script>

    <script src="owner-dashboard.js"></script>

    <!-- Final check after scripts load -->
    <script>
        window.addEventListener('load', function () {
            console.log('âœ… Page fully loaded!');
            console.log('ðŸ” switchPage available:', typeof window.switchPage);
            console.log('ðŸ” addMemberByStudentId available:', typeof window.addMemberByStudentId);
            console.log('ðŸ” Menu items found:', document.querySelectorAll('.menu-item').length);
            console.log('ðŸ” Pages found:', document.querySelectorAll('.page').length);

            // Ensure menu items have click handlers (onclick in HTML + event listener as backup)
            document.querySelectorAll('.menu-item').forEach(item => {
                if (!item.hasAttribute('data-listener-added')) {
                    item.setAttribute('data-listener-added', 'true');
                    item.addEventListener('click', function (e) {
                        const pageName = this.getAttribute('data-page');
                        console.log('ðŸŽ¯ Menu item clicked (event listener):', pageName);
                        if (typeof window.switchPage === 'function') {
                            window.switchPage(pageName);
                        }
                    });
                }
            });

            // Test backend connection
            const apiUrl = window.API_URL || 'http://localhost:4000';
            fetch(`${apiUrl}/health`)
                .then(() => console.log('âœ… Backend server is running'))
                .catch(() => console.error('âŒ Backend server not responding!'));

            // Ensure club name is loaded
            setTimeout(() => {
                const clubNameEl = document.getElementById('clubName');
                if (clubNameEl && clubNameEl.textContent === 'Loading...') {
                    console.log('âš ï¸ Club name still loading, reloading stats...');
                    if (typeof loadDashboardStats === 'function') {
                        loadDashboardStats();
                    }
                }
            }, 1000);
        });
    </script>
</body>

</html>
